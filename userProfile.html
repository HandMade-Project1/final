<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User profile page</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="canonical" href="https://getbootstrap.com/docs/5.3/examples/carousel/">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">

  <link rel="stylesheet" href="userProfile.css">
</head>

<body>
  <header>
    <div class="top_header">
      <div class="container">
        <a href="#" class="logo"> <img src="crf.png" alt=""></a>
        <form action="product.html" class="search_box" id="searchForm">
          <div class="select_box">
            <select id="category" name="category">
              <option value="All Categories">All Categories</option>
              <option value="Candles Gift">Candles Gift</option>
              <option value="Home Decor Gift">Home Decor Gift</option>
              <option value="Wool Gift">Wool Gift</option>
              <option value="Embroidery Gift">Embroidery Gift</option>
            </select>
          </div>
          <input type="text" name="search" id="search" placeholder="Search for Categories" required>
          <button type="submit" id="search button">
            <i class="fa-solid fa-magnifying-glass"></i>
          </button>
        </form>
        <div id="searchResults"></div>
        <div class="header_icons">
          <div class="icon">
            <a href="#">
              <i class="fa-regular fa-heart" style="color: #C4C1E4;"></i>
            </a>
          </div>
          <div onclick="open_close_cart()" class="icon">
            <a href="#">
              <i class="fa-solid fa-cart-shopping" style="color: #C4C1E4;"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
    <div class="bottom_header">
      <div class="container">
        <nav class="nav">
          <ul class="nav_links">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="../products/index.html">Gifts</a></li>
            <li><a href="#">About us</a></li>
            <li><a href="#">Contact us</a></li>
          </ul>
        </nav>
        <div class="login_signup btns">
          <a href="login.html" class="btn" id="login-button">Login <i class="fa-solid fa-right-to-bracket"></i></a>
          <a href="register.html" class="btn" id="signup-button">Sign Up <i class="fa-solid fa-user-plus"></i></a>
        </div>
      </div>
    </div>
  </header>
  <div class="container1 rounded bg-white mt-5 mb-5">
    <div class="row">

      <div class="col-md-3 border-right">
        <div class="d-flex flex-column align-items-center text-center p-3 py-5">
          <img class="rounded-circle mt-5" width="150px"
            src="https://i.pinimg.com/736x/5b/30/5f/5b305fca208d6162872c715f4c7643e1.jpg">
        </div>
      </div>


      <div class="col-md-5 border-right">
        <div class="mt-3">
          <!-- <span class="font-weight-bold" id="userName">Name</span> -->
          <span class="text-black-50" id="userEmail">Email</span>
        </div>
        <div class="p-3 py-5">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="text-right">Profile Settings</h4>
          </div>
          <div class="row mt-2">
            <div class="col-md-12">
              <label class="labels">First Name</label>
              <input type="text" class="form-control" id="firstName" value="">
            </div>
          </div>
          <div class="row mt-2">
            <div class="col-md-12">
              <label class="labels">Email Account</label>
              <input type="text" class="form-control" id="email" value="">
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-md-12">
              <label class="labels">Password</label>
              <input type="text" class="form-control" id="password" value="">
            </div>
          </div>
          <div class="mt-5 text-center">
            <button class="btn btn-primary profile-button" id="saveChanges" type="button">Save Changes</button>
            <button class="btn btn-primary profile-button" id="logoutButton" type="button">Log Out</button>

          </div>
        </div>
      </div>
    </div>
  </div>
  <footer class="text-center text-lg-start ">
    <!-- Section: Social media -->
    <section class="d-flex justify-content-center justify-content-lg-between p-4 border-bottom">
      <!-- Left -->
      <div class="me-5 d-none d-lg-block">
        <span style="padding-left: 40px;">Get connected with us on social networks:</span>
      </div>
      <!-- Left -->

      <!-- Right -->
      <div>
        <a href="" class="me-4 text-reset">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a href="" class="me-4 text-reset">
          <i class="fab fa-twitter"></i>
        </a>
        <a href="" class="me-4 text-reset">
          <i class="fab fa-google"></i>
        </a>
        <a href="" class="me-4 text-reset">
          <i class="fab fa-instagram"></i>
        </a>
        <a href="" class="me-4 text-reset">
          <i class="fab fa-linkedin"></i>
        </a>

      </div>
      <!-- Right -->
    </section>
    <!-- Section: Social media -->

    <!-- Section: Links  -->
    <section class="">
      <div class="container text-center text-md-start mt-5">
        <!-- Grid row -->
        <div class="row mt-3">
          <!-- Grid column -->
          <div class="col-md-3 col-lg-4 col-xl-3 mx-auto mb-4">
            <!-- Content -->
            <h6 class="text-uppercase fw-bold mb-4">
              <i class="fas fa-gem me-3"></i>Crafted Heart
            </h6>
            <p>
              dedicated platform offering a wide variety of handmade products crafted with care and passion.
            </p>
          </div>
          <!-- Grid column -->

          <!-- Grid column -->
          <div class="col-md-2 col-lg-2 col-xl-2 mx-auto mb-4">
            <!-- Links -->
            <h6 class="text-uppercase fw-bold mb-4">
              Products
            </h6>
            <p>
              <a href="product.html" class="text-reset">Candles Gift</a>
            </p>
            <p>
              <a href="product.html" class="text-reset">Home Decor Gift</a>
            </p>
            <p>
              <a href="product.html" class="text-reset">Wool Gift</a>
            </p>
            <p>
              <a href="product.html" class="text-reset">Embroidery Gift</a>
            </p>
          </div>
          <!-- Grid column -->

          <!-- Grid column -->
          <div class="col-md-3 col-lg-2 col-xl-2 mx-auto mb-4">
            <!-- Links -->
            <h6 class="text-uppercase fw-bold mb-4">
              Useful links
            </h6>
            <p>
              <a href="product.html" class="text-reset">Gifts</a>
            </p>
            <p>
              <a href="contact.html" class="text-reset">Contact us</a>
            </p>
            <p>
              <a href="about.html" class="text-reset">About us</a>
            </p>

          </div>
          <!-- Grid column -->

          <!-- Grid column -->
          <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4">
            <!-- Links -->
            <h6 class="text-uppercase fw-bold mb-4">Contact</h6>
            <p><i class="fas fa-home me-3"></i> Jordan, Zarqa</p>
            <p>
              <i class="fas fa-envelope me-3"></i>
              craftedheart@gmail.com
            </p>
            <p><i class="fas fa-phone me-3"></i>0775325987</p>
          </div>
          <!-- Grid column -->
        </div>
        <!-- Grid row -->
      </div>
    </section>
    <!-- Section: Links  -->

  </footer>


  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
    import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";
    import { getFirestore, collection } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAC2zpAE0YqT_zQG1zwYjmjgBiKjDfvlA8",
      authDomain: "crafted-heart.firebaseapp.com",
      projectId: "crafted-heart",
      storageBucket: "crafted-heart.firebasestorage.app",
      messagingSenderId: "356981294414",
      appId: "1:356981294414:web:ea3a6c8e9dd59df7728a1f",
      measurementId: "G-PQ9WCXTS0L"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // const userName = document.getElementById("userName");
    const userEmail = document.getElementById("userEmail");
    const firstNameInput = document.getElementById("firstName");
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const saveChangesButton = document.getElementById("saveChanges");
    const logoutButton = document.getElementById("logoutButton");


 
  
  auth.onAuthStateChanged(async (user) => {
    if (user) {
    
      userEmail.textContent = user.email;

      // Fetch user data from Firestore
      try {
        const userDocRef = doc(db, "users", user.uid); 
        const docSnap = await getDoc(userDocRef);

        if (docSnap.exists()) {
          
          const userData = docSnap.data();
          emailInput.value = userData.email || "";
        } else {
          console.log("No such document in Firestore!");
        }
      } catch (error) {
        console.error("Error fetching document from Firestore:", error);
      }
    } else {
      alert("No user is signed in.");
    }
  });

 
  saveChangesButton.addEventListener("click", async () => {
    const user = auth.currentUser;
    if (user) {
      const updatedEmail = emailInput.value;
      const updatedPassword = passwordInput.value;

      try {
       
        if (updatedEmail !== user.email) {
          await user.updateEmail(updatedEmail);
        }

        
        if (updatedPassword) {
          await user.updatePassword(updatedPassword);
        }

        alert("Profile updated successfully!");
      } catch (error) {
        console.error("Error updating profile:", error);
        alert("Failed to update profile.");
      }
    } else {
      alert("No user is signed in.");
    }
  });

  
  logoutButton.addEventListener("click", async () => {
    try {
      await signOut(auth);
      window.location.href = "./login.html";
    } catch (error) {
      console.error("Error signing out:", error);
      alert("Failed to log out. Please try again.");
    }
  });



  ////////////////// to hide and display login and sign up buttons if user //////////////////////////////////////
auth.onAuthStateChanged((user) => {
    console.log("Auth state changed:", user);
  
    const welcomeMessageElement = document.getElementById("welcome-message");
    const loginButton = document.getElementById("login-button");
    const signupButton = document.getElementById("signup-button");
  
    if (user) {
      console.log("User ID:", user.uid);
      fetchAndDisplayUserName(user.uid);
  
      loginButton.style.display = "none";
      signupButton.style.display = "none";
    } else {
      console.log("No user signed in.");

      loginButton.style.display = "block";
      signupButton.style.display = "block";
  
      welcomeMessageElement.textContent = "";
    }
  });
// // Function to fetch and display the user's name dynamically
async function fetchAndDisplayUserName(uid) {
    try {
      const userDocRef = doc(db, "users", uid);
      const userDoc = await getDoc(userDocRef);
  
      if (userDoc.exists()) {
        const userName = userDoc.data().firstName;
        document.getElementById("welcome-message").innerHTML = `Welcome <span id="user-name">${userName}</span>!`;
    } else {
        console.error("No user data found");
      }
    } catch (error) {
      console.error("Error fetching user data:", error);
    }
  }

  </script>
</body>

</html>